jQuery(document).ready(function(e){function a(a,n){function i(e){var a=e;if(-1!==a.indexOf("<span")){var t=a.indexOf("<span");return a.substr(0,t-1)}return a}e("#admin-menu-manager").empty();var s="",l=a,d=n;if(-1!=a.indexOf("["))var r=JSON.parse(l),u=JSON.parse(d);else var r=JSON.parse(atob(l)),u=JSON.parse(atob(d));for(key in r){if(-1!==r[key][4].indexOf("wp-menu-separator"))s+='<li class="mjs-nestedSortable-no-nesting menu-item"><div class="menu-item-separator"><span class="hr-container"><hr class="separator-rule"></span><i class="fa fa-trash-o delete-menu-item delete-separator" title="Remove separator" aria-hidden="true"></i></div></li>';else{var o=i(r[key][0]),m=r[key][2],c=r[key][6],f=r[key][4],p=decodeURIComponent(r[key][3]),v=decodeURIComponent(r[key][5]),h=r[key][1];if(-1!==c.indexOf("dashicons-"))y='<span data="'+c+'" class="menu-item-icon dashicons-before '+c+'"></span>';else var y='<span data="'+c+'" class="svg svg-menu-icon menu-item-icon" style="background-image: url(&quot;'+c+'&quot;);"></span>';s+='<li class="menu-item"><div>'+y+'<input readonly="readonly" type="text" data="'+m+'" class="menu-label" value="'+o+'"><i class="fa fa-pencil-square-o edit-menu-item" title="Edit menu label" aria-hidden="true"></i><input readonly="readonly" type="text" data="'+m+'" class="menu-url restricted-advanced-functionality" style="margin-left:20px;" value="'+m+'"><i class="restricted-advanced-functionality fa fa-link edit-menu-item-link" title="Edit menu link" aria-hidden="true"></i><input readonly="readonly" type="text" data="'+f+'" class="menu-classes restricted-advanced-functionality" style="margin-left:20px;" value="'+f+'"><i class="restricted-advanced-functionality fa fa-code edit-menu-item-classes" title="Edit menu classes" aria-hidden="true"></i>'+t(h)+'<input readonly="readonly" type="text" data="'+p+'" class="menu-third-value" style="margin-left:20px;" value="'+p+'"><input readonly="readonly" type="text" data="'+v+'" class="menu-fifth-value" style="margin-left:20px;" value="'+v+'"><i class="fa fa-eye-slash remove-menu-item" title="Hide menu item" aria-hidden="true"></i></div>';var g=u[m];if(null!=g){s+="<ul>";for(key in g){var b=i(g[key][0]),_=g[key][2],k=g[key][1],x=decodeURIComponent(g[key][3]);s+='<li class="menu-item"><div><span data="dashicons-admin-generic" class="menu-item-icon dashicons-before dashicons-admin-generic"></span><input readonly="readonly" type="text" data="'+m+"["+_+']" class="menu-label" value="'+b+'"><i class="fa fa-pencil-square-o edit-menu-item" title="Edit menu label" aria-hidden="true"></i><input readonly="readonly" type="text" data="'+_+'" class="menu-url restricted-advanced-functionality" style="margin-left:20px;" value="'+_+'"><i class="restricted-advanced-functionality fa fa-link edit-menu-item-link" title="Edit menu link" aria-hidden="true"></i><input readonly="readonly" type="text" data="menu-top" class="menu-classes restricted-advanced-functionality" style="margin-left:20px;" value="menu-top"><i class="restricted-advanced-functionality fa fa-code edit-menu-item-classes" title="Edit menu classes" aria-hidden="true"></i>'+t(k)+'<input readonly="readonly" type="text" data="" class="menu-third-value" style="margin-left:20px;" value="'+x+'"><input readonly="readonly" type="text" data="" class="menu-fifth-value" style="margin-left:20px;" value=""><i class="fa fa-eye-slash remove-menu-item" title="Hide menu item" aria-hidden="true"></i></div></li>'}s+="</ul>"}s+="</li>"}}e("#admin-menu-manager").append(s)}function t(a){for(var t=function(){var a=e("#admin-capabilities").text();if(null!=a)var t=a.split(",");return t}(),n=t.length,i='<select style="margin-left:20px; width: 180px;" disabled="true" class="restricted-advanced-functionality menu-capability">',s=0;s<n;s++)a==t[s]?i+='<option selected="selected">'+t[s]+"</option>":i+="<option>"+t[s]+"</option>";return i+='</select><i class="restricted-advanced-functionality fa fa-lock edit-menu-capability" title="Edit menu access" aria-hidden="true"></i>'}function n(){"none"==e(".restricted-advanced-functionality").css("display")?e(".restricted-advanced-functionality").css({display:"none"}):e(".restricted-advanced-functionality").css({display:"inline-block"})}function i(){"none"==e(".restricted-advanced-functionality").css("display")&&(e(".restricted-advanced-functionality").css({display:"inline-block"}),e("#advanced-menu-functionality").html('<i class="fa fa-universal-access" aria-hidden="true"></i> Simple functionality'))}function s(){var a=e("#wp_custom_admin_interface_remove_menu_item").val();if(null!=a)var t=a.split(",");e(".menu-label").each(function(a){var n=e(this).attr("data"),i=e(this).parent().parent(),s=e(this).parent().find(".remove-menu-item");-1!=e.inArray(n,t)?(e(i).addClass("removed-menu-item"),e(s).addClass("fa-eye"),e(s).removeClass("fa-eye-slash")):(e(i).removeClass("removed-menu-item"),e(this).removeClass("fa-eye"),e(this).addClass("fa-eye-slash"))})}e("#add-newly-added-menu-items").click(function(a){function i(e){var a=e;if(-1!==a.indexOf("<span")){var t=a.indexOf("<span");return a.substr(0,t-1)}return a}a.preventDefault();var l="",d=JSON.parse(e(this).attr("menudata")),r=JSON.parse(e(this).attr("submenudata"));for(key in d){var u=i(d[key][0]),o=d[key][2],m=d[key][6],c=d[key][4],f=decodeURIComponent(d[key][3]),p=decodeURIComponent(d[key][5]),v=d[key][1];if(u.length>0){if(null==m||-1===m.indexOf("dashicons-"))h='<span data="'+m+'" class="svg svg-menu-icon menu-item-icon" style="background-image: url(&quot;'+m+'&quot;);"></span>';else var h='<span data="'+m+'" class="menu-item-icon dashicons-before '+m+'"></span>';l+='<li class="menu-item"><div>'+h+'<input readonly="readonly" type="text" data="'+o+'" class="menu-label" value="'+u+'"><i class="fa fa-pencil-square-o edit-menu-item" title="Edit menu label" aria-hidden="true"></i><input readonly="readonly" type="text" data="'+o+'" class="menu-url restricted-advanced-functionality" style="margin-left:20px;" value="'+o+'"><i class="restricted-advanced-functionality fa fa-link edit-menu-item-link" title="Edit menu link" aria-hidden="true"></i><input readonly="readonly" type="text" data="'+c+'" class="menu-classes restricted-advanced-functionality" style="margin-left:20px;" value="'+c+'"><i class="restricted-advanced-functionality fa fa-code edit-menu-item-classes" title="Edit menu classes" aria-hidden="true"></i>'+t(v)+'<input readonly="readonly" type="text" data="'+f+'" class="menu-third-value" style="margin-left:20px;" value="'+f+'"><input readonly="readonly" type="text" data="'+p+'" class="menu-fifth-value" style="margin-left:20px;" value="'+p+'"><i class="fa fa-eye-slash remove-menu-item" title="Hide menu item" aria-hidden="true"></i></div>';var y=r[o];if(null!=y){l+="<ul>";for(key in y){var g=i(y[key][0]),b=y[key][2],_=y[key][1],k=decodeURIComponent(y[key][3]);l+='<li class="menu-item"><div><span data="dashicons-admin-generic" class="menu-item-icon dashicons-before dashicons-admin-generic"></span><input readonly="readonly" type="text" data="'+o+"["+b+']" class="menu-label" value="'+g+'"><i class="fa fa-pencil-square-o edit-menu-item" title="Edit menu label" aria-hidden="true"></i><input readonly="readonly" type="text" data="'+b+'" class="menu-url restricted-advanced-functionality" style="margin-left:20px;" value="'+b+'"><i class="restricted-advanced-functionality fa fa-link edit-menu-item-link" title="Edit menu link" aria-hidden="true"></i><input readonly="readonly" type="text" data="menu-top" class="menu-classes restricted-advanced-functionality" style="margin-left:20px;" value="menu-top"><i class="restricted-advanced-functionality fa fa-code edit-menu-item-classes" title="Edit menu classes" aria-hidden="true"></i>'+t(_)+'<input readonly="readonly" type="text" data="" class="menu-third-value" style="margin-left:20px;" value="'+k+'"><input readonly="readonly" type="text" data="" class="menu-fifth-value" style="margin-left:20px;" value=""><i class="fa fa-eye-slash remove-menu-item" title="Hide menu item" aria-hidden="true"></i></div></li>'}l+="</ul>"}l+="</li>"}}e("#admin-menu-manager").prepend(l),s(),n(),e('<div class="notice notice-info is-dismissible restore-menu-message"><p>The newly added menu items have now been added to the top of your menu.</p></div>').insertAfter("#admin-menu-manager-buttons"),setTimeout(function(){e(".restore-menu-message").slideUp()},5500)}),a(e("#wp_custom_admin_interface_top_level_menu").val(),e("#wp_custom_admin_interface_sub_level_menu").val()),e("#restore-default-menu").click(function(t){t.preventDefault();if(1==confirm("Are you sure you want to restore the admin menu to the default WordPress menu? This will delete any customisations made to the menu.")){var i=e("#restore-default-menu").attr("menudata"),l=e("#restore-default-menu").attr("submenudata");e("#wp_custom_admin_interface_top_level_menu").val(i),e("#wp_custom_admin_interface_sub_level_menu").val(l),e("#wp_custom_admin_interface_remove_menu_item").val(""),a(i,l),s(),n(),e('<div class="notice notice-info is-dismissible restore-menu-message"><p>The menu has been successfully restored to the default WordPress menu. Please press "Save All Settings" to save the changes.</p></div>').insertAfter("#admin-menu-manager-buttons"),setTimeout(function(){e(".restore-menu-message").slideUp()},5500)}}),e("#restore-last-save").click(function(t){t.preventDefault();if(1==confirm("Are you sure you want to restore the admin menu to the last save you did? This will delete any edits you have just done.")){var i=e("#restore-last-save").attr("menudata"),l=e("#restore-last-save").attr("submenudata"),d=e("#restore-last-save").attr("removeditems");e("#wp_custom_admin_interface_top_level_menu").val(i),e("#wp_custom_admin_interface_sub_level_menu").val(l),e("#wp_custom_admin_interface_remove_menu_item").val(d),a(i,l),s(),n(),e('<div class="notice notice-info is-dismissible restore-menu-message"><p>The menu has been successfully restored to the previous save. Please press "Save All Settings" to save the changes.</p></div>').insertAfter("#admin-menu-manager-buttons"),setTimeout(function(){e(".restore-menu-message").slideUp()},5500)}}),e("#poststuff").on("click","#add-menu-item",function(a){a.preventDefault(),e("#admin-menu-manager").prepend('<li class="menu-item menu-item-custom"><div><span data="dashicons-admin-generic" class="menu-item-icon dashicons-before dashicons-admin-generic"></span><input readonly="readonly" type="text" data="" class="menu-label" value="" placeholder="Enter menu label"><i class="fa fa-pencil-square-o edit-menu-item" title="Edit menu label" aria-hidden="true"></i><input readonly="readonly" type="text" data="" class="menu-url" style="margin-left:20px;" value="" placeholder="Enter menu link"><i class="fa fa-link edit-menu-item-link" title="Edit menu link" aria-hidden="true"></i><input readonly="readonly" type="text" data="menu-top added-custom-menu-item" class="menu-classes restricted-advanced-functionality" style="margin-left:20px;" value="menu-top added-custom-menu-item"><i class="restricted-advanced-functionality fa fa-code edit-menu-item-classes" title="Edit menu classes" aria-hidden="true"></i>'+t("read")+'<input readonly="readonly" type="text" data="" class="menu-third-value" style="margin-left:20px;" value=""><input readonly="readonly" type="text" data="" class="menu-fifth-value" style="margin-left:20px;" value=""><i class="fa fa-eye-slash remove-menu-item" title="Hide menu item" aria-hidden="true"></i><i class="fa fa-trash-o delete-menu-item delete-custom-menu-item" title="Remove menu item" aria-hidden="true"></i></div></li>'),n()}),function(){for(var a=e("#admin-menu-manager .menu-item div"),t=0;t<a.length;++t){var n=a[t];-1!==(e(n).find(".menu-classes").val()||"").indexOf("added-custom-menu-item")&&e(n).append('<i class="fa fa-trash-o delete-menu-item delete-custom-menu-item" title="Remove menu item" aria-hidden="true"></i>')}}(),e(".wrap").on("click","#add-separator",function(a){a.preventDefault(),e("#admin-menu-manager").prepend('<li class="mjs-nestedSortable-no-nesting menu-item"><div class="menu-item-separator"><span class="hr-container"><hr class="separator-rule"></span><i class="fa fa-trash-o delete-menu-item delete-separator" title="Remove separator" aria-hidden="true"></i></div></li>')}),e(".wrap").on("click","#advanced-menu-functionality",function(a){if(a.preventDefault(),"inline-block"==e(".restricted-advanced-functionality").css("display"))e(".restricted-advanced-functionality").css({display:"none"}),e("#advanced-menu-functionality").html('<i class="fa fa-superpowers" aria-hidden="true"></i> Advanced functionality');else{new ClipboardJS("#advanced-menu-functionality");1==confirm("With great power comes great responsibility! With this option enabled you have the potential to do edits on the default WordPress menu options. But this also means that you may not be able to find your way back here if you start hiding all the standard menus! As a precaution we have copied an emergency URL to your clipboard. So if you get stuck just paste this into the browser and all settings related to this custom admin menu will be deleted so you can start again. This URL can also be found in the FAQ section of the Wordpress plugin website.")&&(e(".restricted-advanced-functionality").css({display:"inline-block"}),e("#advanced-menu-functionality").html('<i class="fa fa-universal-access" aria-hidden="true"></i> Simple functionality'))}}),e(".restricted-advanced-functionality").css({display:"none"}),e(".wrap").on("click",".delete-menu-item",function(){1==confirm("Are you sure you want to delete this menu item?")&&e(this).parent().parent().remove()}),e(".wrap").on("click",".edit-menu-item",function(){1==e(this).prev().prop("readonly")?(e(this).prev().prop("readonly",!1),e(this).removeClass("fa-pencil-square-o"),e(this).addClass("fa-check")):(e(this).prev().prop("readonly",!0),e(this).addClass("fa-pencil-square-o"),e(this).removeClass("fa-check"))}),e(".wrap").on("click",".edit-menu-item-link",function(){1==e(this).prev().prop("readonly")?(e(this).prev().prop("readonly",!1),e(this).removeClass("fa-link"),e(this).addClass("fa-check")):(e(this).prev().prop("readonly",!0),e(this).addClass("fa-link"),e(this).removeClass("fa-check"))}),e(".wrap").on("click",".edit-menu-item-classes",function(){1==e(this).prev().prop("readonly")?(e(this).prev().prop("readonly",!1),e(this).removeClass("fa-code"),e(this).addClass("fa-check")):(e(this).prev().prop("readonly",!0),e(this).addClass("fa-code"),e(this).removeClass("fa-check"))}),e(".wrap").on("click",".edit-menu-capability",function(){1==e(this).prev().prop("disabled")?(e(this).prev().prop("disabled",!1),e(this).removeClass("fa-lock"),e(this).addClass("fa-check")):(e(this).prev().prop("disabled",!0),e(this).addClass("fa-lock"),e(this).removeClass("fa-check"))}),e(".wrap").on("click",".remove-menu-item",function(){var a=e(this).parent().parent();e(a).hasClass("removed-menu-item")?(e(a).removeClass("removed-menu-item"),e(this).removeClass("fa-eye"),e(this).addClass("fa-eye-slash")):(e(a).addClass("removed-menu-item"),e(this).addClass("fa-eye"),e(this).removeClass("fa-eye-slash"))}),s(),e(".wrap").on("click",".menu-item-icon",function(){var a=this;e("#custom-icon-dialog").hasClass("ui-dialog-content")&&e("#custom-icon-dialog").dialog("isOpen")?e("#custom-icon-dialog").dialog("close"):(e("#custom-icon-dialog").dialog({modal:!0,draggagle:!0,width:700,open:function(){e(".ui-dialog-titlebar-close").blur(),e(".wp_custom_admin_interface_media_upload_button").blur(),e(this).unbind("click")}}),e("#custom-icon-dialog").on("click",".icon-for-selection",function(){var t=e(this).attr("data");-1!==t.indexOf("dashicons-")?(e(a).parent().prepend('<span data="'+t+'" class="menu-item-icon dashicons-before '+t+'"></span>'),e(a).remove()):(e(a).parent().prepend('<span data="'+t+'" class="svg svg-menu-icon menu-item-icon" style="background-image: url(&quot;'+t+'&quot;)"></span>'),e(a).remove()),e("#custom-icon-dialog").dialog("close")}),e("#custom-icon-dialog").on("click",".wp_custom_admin_interface_media_upload_button",function(t){t.preventDefault();var n=wp.media({title:"Upload Image",multiple:!1}).open().on("select",function(t){var i=n.state().get("selection").first().toJSON().url;e(a).parent().prepend('<span data="'+i+'" class="svg svg-menu-icon menu-item-icon" style="background-image: url(&quot;'+i+'&quot;)"></span>'),e(a).remove(),e("#custom-icon-dialog").dialog("close")})}))}),e("#admin-menu-manager").nestedSortable({handle:"div",items:"li",toleranceElement:"> div",maxLevels:2,listType:"ul",isTree:!0}),e("#custom_admin_interface_settings_form").submit(function(a){a.preventDefault(),e(".settings-loading-message").remove(),e('<div class="notice notice-warning is-dismissible settings-loading-message"><p><i class="fa fa-circle-o-notch wp-custom-admin-interface-loading" aria-hidden="true"></i> Please wait while we save the settings...</p></div>').insertAfter(".wp-custom-admin-interface-save-button");var t="";e("#admin-menu-manager > .removed-menu-item > div").each(function(a){var n=e(this).find(".menu-url").val();e(this).find(".menu-label").attr("data",n),t+=n+","}),e("#admin-menu-manager > li > ul > .removed-menu-item").each(function(a){var n=e(this).find(".menu-url").val(),i=e(this).parent().prev().find(".menu-label").attr("data")+"["+n+"]";e(this).find(".menu-label").attr("data",i),t+=i+","}),e("#wp_custom_admin_interface_remove_menu_item").val(t),e(".duplication-error").removeClass("duplication-error");var n=[];e("#admin-menu-manager > .menu-item > div").each(function(){var a=e(this).find(".menu-url").val();n.push(a)});for(var s=n.slice().sort(),l=[],d=0;d<n.length-1;d++)s[d+1]==s[d]&&null!=s[d]&&l.push(s[d]);if(l.length>0){r=!0;alert("We found there were 2 or more items in the top level of your menu that have the same destination URL. This can cause unexpected results. As a result we won't save the settings until the issue is corrected. We have highlighted these items red. Please change one of the URL's or delete one of the menu items."),e.each(l,function(a,t){var n=t;e("#admin-menu-manager > .menu-item > div").each(function(){var a=e(this).find(".menu-url").val(),t=e(this).find(".menu-url");a==n&&(e(t).addClass("duplication-error"),i())})})}else var r=!1;e(".no-url-value").removeClass("no-url-value");var u=0;e("#admin-menu-manager .menu-url").each(function(){""==e(this).val()&&(e(this).addClass("no-url-value"),u++)}),u>0&&(alert("We found that some of your menu items have no URL. Please make sure every item has a URL. As a result we won't save the settings until the issue is corrected. We have highlighted these items red."),r=!0,i());var o=[],m=0;e("#admin-menu-manager > li").each(function(a){var t=e(this).find(".menu-label").val(),n=e(this).find(".menu-capability").val(),i=e(this).find(".menu-url").val(),s=encodeURIComponent(e(this).find(".menu-third-value").val()).replace(/%20/g," "),l=e(this).find(".menu-classes").val(),d=encodeURIComponent(e(this).find(".menu-fifth-value").val()).replace(/%20/g," "),r=e(this).find(".menu-item-icon").attr("data"),u="separator-"+m;m++;if(null==t)c=["","read",u,"","wp-menu-separator"];else var c=[t,n,i,s,l,d,r];o.push(c)});var c=JSON.stringify(o);e("#wp_custom_admin_interface_top_level_menu").val(c),e("#admin-menu-manager > li > ul > .mjs-nestedSortable-no-nesting").remove();var f={};e("#admin-menu-manager > li > ul").each(function(a){var t=e(this).parent().find(".menu-url").val(),n=(e(this),e(this).find("li")),i={};e(n).each(function(a){var t=e(this).find(".menu-label").val(),n=e(this).find(".menu-capability").val(),s=e(this).find(".menu-url").val(),l=encodeURIComponent(e(this).find(".menu-third-value").val()).replace(/%20/g," ");subLevelMenuItemArray="undefined"==l?[t,n,s]:[t,n,s,l],i[a]=subLevelMenuItemArray}),f[t]=i});var p=JSON.stringify(f);if(e("#wp_custom_admin_interface_sub_level_menu").val(p),e(".userAndRoleSelection").each(function(){var a="",t=e(this).next().next();e.each(t.find("select"),function(){var t=e(this).val();a+=t+","}),t.find(".saved_exception_cases").val(a)}),0==r){jQuery.post(ajaxurl,{action:"delete_transients"},function(e){}),e(this).ajaxSubmit({success:function(){e(".settings-loading-message").remove(),e(".settings-saved-message").remove(),e('<div class="notice notice-success is-dismissible settings-saved-message"><p>The settings have been saved.</p></div>').insertAfter(".wp-custom-admin-interface-save-button"),setTimeout(function(){e(".settings-saved-message").slideUp()},3e3)}})}})});