jQuery(document).ready(function(e){function t(t){if(e("#toolbar-menu-manager").empty(),-1!=t.indexOf("{"))a=JSON.parse(t);else var a=JSON.parse(atob(t));console.log(a);var i=[];do{!function(t){for(node in t){var a=t[node].id,s=n=(""+t[node].title).replace(/\'/g,'"');if(-1!==n.indexOf("<"))var n=e("<div/>").html(n).text()+"<title-not-editable>";var o=t[node].parent,r=t[node].href,l=t[node].group,d=(t[node].meta,'<input style="font-weight:bold;" title="'+a+'" readonly="readonly" type="text" class="node-title" value=\''+n+"'>");-1!==s.indexOf("<")||(d+='<i class="fa fa-pencil-square-o edit-node-title" title="Edit menu title" aria-hidden="true"></i>');var m='<input style="margin-left: 20px;" readonly="readonly" type="text" class="node-href" value="'+r+'"><i class="fa fa-link edit-node-link" title="Edit menu link" aria-hidden="true" style="display: inline-block;"></i>',u='<i class="fa fa-eye-slash remove-node-item" title="Hide menu item" aria-hidden="true"></i>';if(-1==i.indexOf(a))if(0==o)i.push('<li><div data-group="'+l+'"><span data="'+a+'" class="node-id" style="display:none;">'),i.push(a),i.push("</span>"+d+m+u+"</div>"),i.push("</li>");else if(-1!=i.indexOf(o)){var c=i.indexOf(o),f=i.indexOf("</ul>",c);"<ul>"==i[c+2]?(i.splice(f+0,0,'<li><div data-group="'+l+'"><span class="node-id" data="'+a+'" style="display:none;">'),i.splice(f+1,0,a),i.splice(f+2,0,"</span>"+d+m+u+"</div>"),i.splice(f+3,0,"</li>")):(i.splice(c+2,0,"<ul>"),i.splice(c+3,0,'<li><div data-group="'+l+'"><span class="node-id" data="'+a+'" style="display:none;">'),i.splice(c+4,0,a),i.splice(c+5,0,"</span>"+d+m+u+"</div>"),i.splice(c+6,0,"</li>"),i.splice(c+7,0,"</ul>"))}}}(a);var s=0,n=0;for(node in a){s++;var o=a[node].id;e.inArray(o,i)>=0&&n++}}while(s!==n);var r=i.join("");e("#toolbar-menu-manager").append(r)}function a(){var t=e("#wp_custom_admin_interface_remove_toolbar_item").val();if(null!=t)var a=t.split(",");e("#toolbar-menu-manager li > div").each(function(t){var i=e(this),s=e(this).find(".node-id").attr("data"),n=e(this).parent().find(".remove-node-item");-1!=e.inArray(s,a)?(e(i).addClass("removed-node-item"),e(n).addClass("fa-eye"),e(n).removeClass("fa-eye-slash")):(e(i).removeClass("removed-node-item"),e(n).removeClass("fa-eye"),e(n).addClass("fa-eye-slash"))})}t(e("#wp_custom_admin_interface_primary_toolbar_menu").val()),e("#toolbar-menu-manager").nestedSortable({handle:"div",items:"li",toleranceElement:"> div",listType:"ul",isTree:!0}),e(".wrap").on("click",".edit-node-title",function(){1==e(this).prev().prop("readonly")?(e(this).prev().prop("readonly",!1),e(this).removeClass("fa-pencil-square-o"),e(this).addClass("fa-check")):(e(this).prev().prop("readonly",!0),e(this).addClass("fa-pencil-square-o"),e(this).removeClass("fa-check"))}),e(".wrap").on("click",".edit-node-link",function(){1==e(this).prev().prop("readonly")?(e(this).prev().prop("readonly",!1),e(this).removeClass("fa-link"),e(this).addClass("fa-check")):(e(this).prev().prop("readonly",!0),e(this).addClass("fa-link"),e(this).removeClass("fa-check"))}),e(".wrap").on("click",".remove-node-item",function(){var t=e(this).parent();e(t).hasClass("removed-node-item")?(e(t).removeClass("removed-node-item"),e(this).removeClass("fa-eye"),e(this).addClass("fa-eye-slash")):(e(t).addClass("removed-node-item"),e(this).addClass("fa-eye"),e(this).removeClass("fa-eye-slash"))}),a(),e("#poststuff").on("click","#add-node-item",function(t){t.preventDefault();var a=function(){var t="unique-node-",a=t.length,i=[];if(e("#toolbar-menu-manager .node-id").each(function(s){var n=e(this).attr("data"),o=n.length;if(-1!==n.indexOf(t)){var r=n.substr(a,o-a);i.push(parseInt(r))}}),0==i.length)s=1;else{for(var s=i[0],n=0;n<i.length;n++)s<i[n]&&(s=i[n]);s++}return t+s}();e("#toolbar-menu-manager").prepend('<li class="mjs-nestedSortable-branch mjs-nestedSortable-expanded"><div data-group="false" class="ui-sortable-handle"><span class="node-id" data="'+a+'" style="display:none;">'+a+'</span><input style="font-weight:bold;" title="" readonly="readonly" type="text" class="node-title" value=""><i class="fa fa-pencil-square-o edit-node-title" title="Edit menu title" aria-hidden="true"></i><input style="margin-left: 20px;" readonly="readonly" type="text" class="node-href" value=""><i class="fa fa-link edit-node-link" title="Edit menu link" aria-hidden="true" style="display: inline-block;"></i><i class="fa fa-eye-slash remove-node-item" title="Hide menu item" aria-hidden="true"></i><i class="fa fa-trash-o delete-node-item delete-custom-node-item" title="Remove menu item" aria-hidden="true"></i></div></li>')}),e(".wrap").on("click",".delete-node-item",function(){1==confirm("Are you sure you want to delete this menu item?")&&e(this).parent().parent().remove()}),function(){for(var t=e("#toolbar-menu-manager .node-id"),a=0;a<t.length;++a){var i=t[a],s=e(i).parent();-1!==e(i).attr("data").indexOf("unique-node-")&&e(s).append('<i class="fa fa-trash-o delete-node-item delete-custom-node-item" title="Remove menu item" aria-hidden="true"></i>')}}(),e("#restore-default-toolbar").click(function(i){i.preventDefault();if(1==confirm("Are you sure you want to restore the toolbar menu to the default WordPress toolbar? This will delete any customisations made to the menu.")){var s=e("#restore-default-toolbar").attr("toolbardata");e("#wp_custom_admin_interface_primary_toolbar_menu").val(s),e("#wp_custom_admin_interface_remove_toolbar_item").val(""),t(s),a(),e('<div class="notice notice-info is-dismissible restore-menu-message"><p>The toolbar has been successfully restored to the default WordPress toolbar. Please press "Save All Settings" to save the changes.</p></div>').insertAfter("#admin-toolbar-manager-buttons"),setTimeout(function(){e(".restore-menu-message").slideUp()},5500)}}),e("#restore-last-save-toolbar").click(function(i){i.preventDefault();if(1==confirm("Are you sure you want to restore the toolbar menu to the last save you did? This will delete any edits you have just done.")){var s=e("#restore-last-save-toolbar").attr("toolbardata"),n=e("#restore-last-save-toolbar").attr("removeditems");e("#wp_custom_admin_interface_primary_toolbar_menu").val(s),e("#wp_custom_admin_interface_remove_toolbar_item").val(n),t(s),a(),e('<div class="notice notice-info is-dismissible restore-menu-message"><p>The toolbar has been successfully restored to the previous save. Please press "Save All Settings" to save the changes.</p></div>').insertAfter("#admin-toolbar-manager-buttons"),setTimeout(function(){e(".restore-menu-message").slideUp()},5500)}}),e("#custom_admin_interface_settings_form").submit(function(t){t.preventDefault(),e(".settings-loading-message").remove(),e('<div class="notice notice-warning is-dismissible settings-loading-message"><p><i class="fa fa-circle-o-notch wp-custom-admin-interface-loading" aria-hidden="true"></i> Please wait while we save the settings...</p></div>').insertAfter(".wp-custom-admin-interface-save-button"),e(".userAndRoleSelection").each(function(){var t="",a=e(this).next().next();e.each(a.find("select"),function(){var a=e(this).val();t+=a+","}),a.find(".saved_exception_cases").val(t)});var a="";e("#toolbar-menu-manager li > div").each(function(t){if(e(this).hasClass("removed-node-item")){var i=e(this).find(".node-id").attr("data");a+=i+","}}),e("#wp_custom_admin_interface_remove_toolbar_item").val(a);var i={};e("#toolbar-menu-manager li > div").each(function(t){var a=e(this),s="true"===a.attr("data-group"),n=a.find(".node-href").val();""==n&&(n=!1);var o=a.find(".node-id").attr("data"),r=a.parent().parent().prev().find(".node-id").attr("data");null==r&&(r=!1);var l=a.find(".node-title").val();""==l&&(l=!1);var d={group:s,href:n,id:o,meta:[],parent:r,title:l};i[o]=d});var s=JSON.stringify(i);e("#wp_custom_admin_interface_primary_toolbar_menu").val(s);jQuery.post(ajaxurl,{action:"delete_transients"},function(e){}),e(this).ajaxSubmit({success:function(){e(".settings-loading-message").remove(),e(".settings-saved-message").remove(),e('<div class="notice notice-success is-dismissible settings-saved-message"><p>The settings have been saved.</p></div>').insertAfter(".wp-custom-admin-interface-save-button"),setTimeout(function(){e(".settings-saved-message").slideUp()},3e3)}})})});